# 기능 설명

Pantry 앱의 주요 기능에 대한 상세 설명입니다.

## 목차

1. [홈 화면](#홈-화면)
2. [냉장고 관리](#냉장고-관리)
3. [재고 관리](#재고-관리)
4. [쇼핑 리스트](#쇼핑-리스트)
5. [OCR 스캔](#ocr-스캔)
6. [피난소 지도](#피난소-지도)
7. [알림 기능](#알림-기능)
8. [설정](#설정)

## 홈 화면

### 개요

앱의 메인 화면으로, 주요 정보를 한눈에 볼 수 있는 대시보드입니다.

### 주요 기능

- **오늘 만료 알림 카드**: 오늘 만료되는 항목 수 표시 및 상세 페이지 이동
- **요약 카드**: 냉장고 재고 수, 재해 대비 재고 수 표시
- **유통기한 임박 항목**: 7일 이내 만료되는 항목 목록 표시
- **할인 상품 정보**: 주변 할인 상품 정보 섹션 (플레이스홀더)
- **피난소 빠른 액세스**: 상단 액션 버튼을 통한 피난소 지도 접근

### 화면 구성

- 상단: 오늘 만료 알림 카드
- 중간: 요약 카드 (냉장고/재고 수)
- 하단: 유통기한 임박 항목 목록

## 냉장고 관리

### 개요

냉장고 내 재고를 관리하고 유통기한을 추적하는 기능입니다.

### 주요 기능

#### 재고 목록 조회

- 카테고리별로 그룹화된 재고 목록 표시
- 유통기한 순으로 정렬
- 검색 기능: 이름 및 카테고리로 검색
- 필터링 기능: 유통기한 순, 수량 순 정렬

#### 재고 추가

- 수동으로 재고 항목 추가
- 다음 정보 입력:
  - 이름
  - 카테고리
  - 유통기한
  - 수량
  - 메모

#### 재고 수정/삭제

- 재고 항목 수정
- 재고 항목 삭제

#### 유통기한 추적

- 유통기한 임박 항목 강조 표시
- 유통기한 경과 항목 표시
- 유통기한별 색상 구분
- 냉동 처리 기능 (냉동 시 유통기한 임박 목록에서 제외)

#### 유통기한 임박 목록 페이지

- 7일 이내 만료되는 항목만 필터링하여 표시
- 냉동 처리된 항목은 제외
- 항목별 액션:
  - **소비 완료**: 항목 삭제 (Undo 기능으로 복원 가능)
  - **냉동 처리**: 냉동 상태로 변경하여 유통기한 연장

### 데이터 저장

- **온라인**: Cloud Firestore
- **오프라인**: SharedPreferences (로컬 캐시)

## 쇼핑 리스트

### 개요

냉장고 및 재고 관리용 쇼핑 리스트를 관리하는 기능입니다.

### 주요 기능

#### 카테고리별 분류

- **냉장고**: 냉장고 재고용 쇼핑 리스트
- **재고**: 재해 대비 재고용 쇼핑 리스트
- 세그먼트 컨트롤을 통한 카테고리 전환

#### 항목 관리

- 항목 추가
- 항목 완료/미완료 토글
- 항목 삭제
- 예상 가격 표시

#### 일괄 작업

- 전체 완료 처리
- 전체 미완료 처리

### 데이터 저장

- **로컬**: SharedPreferences (영구 저장)
- 로컬 상태 관리 (Riverpod StateNotifier)
- 앱 재시작 시에도 데이터 유지

## 재고 관리

### 개요

재해 대비 재고를 관리하는 기능입니다.

### 주요 기능

#### 재고 목록 조회

- 카테고리별로 그룹화된 재고 목록 표시
- 재고 상태 표시 (충분/부족)
- 검색 기능: 이름으로 검색

#### 재고 추가

- 수동으로 재고 항목 추가
- 다음 정보 입력:
  - 이름
  - 카테고리
  - 수량
  - 목표 수량
  - 메모

#### 재고 수정/삭제

- 재고 항목 수정
- 재고 항목 삭제

#### 재고 상태 모니터링

- 목표 수량 대비 현재 수량 표시
- 부족한 재고 항목 알림

### 데이터 저장

- **온라인**: Cloud Firestore
- **오프라인**: SharedPreferences (로컬 캐시)

## OCR 스캔

### 개요

레시피를 스캔하여 자동으로 재고를 등록하는 기능입니다.

### 주요 기능

#### 이미지 캡처

- 카메라로 레시피 촬영
- 갤러리에서 이미지 선택

#### 텍스트 인식

- Google ML Kit을 사용한 텍스트 인식
- 레시피에서 상품명, 가격, 날짜 추출

#### 재고 자동 등록

- 인식된 정보를 바탕으로 재고 항목 생성
- 사용자가 정보 확인 및 수정 후 저장

#### Firebase AI 활용

- Firebase AI (Gemini 2.0 Flash)를 통한 고급 텍스트 분석
- 상품명 추출 및 카테고리 자동 분류
- 유통기한 자동 추정 (ExpiryDateService와 연동)

### 기술 스택

- **Google ML Kit**: 텍스트 인식
- **Firebase AI**: 고급 텍스트 분석
- **Image Picker**: 이미지 선택

## 피난소 지도

### 개요

주변 피난소 위치를 지도에서 확인하는 기능입니다.

### 주요 기능

#### 위치 기반 검색

- 현재 위치 기반 주변 피난소 검색
- 반경 설정 가능

#### 지도 표시

- Google Maps를 통한 지도 표시
- 피난소 위치 마커 표시
- 피난소 정보 표시

#### 피난소 정보

- 피난소 이름
- 주소
- 거리
- 연락처 정보

#### 비상 상품 목록

- 필수 비상 상품 목록 표시
- 권장 수량 정보 제공
- 필수/선택 상품 구분

#### 경로 안내

- 선택한 피난소까지의 경로 표시
- 네비게이션 앱 연동

### 권한 요구사항

- 위치 권한 (위치 기반 검색)

### 기술 스택

- **Google Maps Flutter**: 지도 표시
- **Geolocator**: 위치 정보

## 알림 기능

### 개요

유통기한 및 재고 상태에 대한 알림을 제공하는 기능입니다.

### 주요 기능

#### 유통기한 알림

- 유통기한 임박 항목 알림 (3일 전)
- 유통기한 경과 항목 알림
- 알림 시간: 매일 오전 9시
- 냉동 처리된 항목은 알림에서 제외
- 데이터 변경 시 자동으로 알림 재스케줄링

#### 재고 알림

- 재고 부족 항목 알림 (수량 5 미만)
- 여러 재고 부족 항목이 있는 경우 통합 알림
- 알림 시간: 매일 오전 9시

#### 알림 설정

- 알림 활성화/비활성화 (영구 저장)
- 유통기한 알림 및 재고 알림 각각 설정 가능
- 설정은 SharedPreferences에 저장되어 앱 재시작 시에도 유지
- 알림 설정 변경 시 즉시 반영

### 알림 타입

- **유통기한 임박**: 유통기한 3일 전 알림 (오전 9시)
- **유통기한 경과**: 유통기한 경과 알림 (오전 9시)
- **재고 부족**: 수량 5 미만 시 알림 (오전 9시)

### 알림 동작 방식

1. 앱 시작 시 알림 서비스 초기화
2. 데이터 로드 시 자동으로 알림 스케줄링
3. 데이터 변경 시 알림 자동 업데이트
4. 알림 설정 변경 시 즉시 반영

### 기술 스택

- **flutter_local_notifications**: 로컬 알림 스케줄링
- **timezone**: 시간대 처리
- **NotificationSchedulingService**: 알림 스케줄링 관리
- **NotificationSettingsService**: 알림 설정 관리
- **ExpiryDateService**: 유통기한 계산

## 설정

### 개요

앱 설정 및 카테고리 관리를 담당하는 기능입니다.

### 주요 기능

#### 카테고리 관리

- 카테고리 추가
- 카테고리 수정
- 카테고리 삭제
- 카테고리 순서 변경

#### 앱 설정

- 알림 설정
- 데이터 동기화 설정
- 앱 정보 표시

#### 데이터 관리

- 캐시 삭제: 앱 캐시 데이터 삭제
- 데이터 백업: Firestore에 모든 데이터 백업 (냉장고, 재고, 쇼핑 리스트, 카테고리)
- 데이터 복원: Firestore에서 백업 데이터 복원
- 백업/복원 진행 상태 표시

### 데이터 저장

- **카테고리**: SharedPreferences (로컬 저장)
- **알림 설정**: SharedPreferences (영구 저장)
- **기타 설정**: SharedPreferences

## 데이터 동기화

### 온라인/오프라인 지원

- **온라인 우선**: Firestore에서 데이터 조회 시도
- **오프라인 폴백**: 실패 시 로컬 데이터 사용
- **자동 동기화**: 온라인 상태일 때 자동 동기화

### 동기화 전략

1. **오프라인 우선**: 캐시에서 먼저 데이터 조회 (빠른 응답)
2. **서버 동기화**: 캐시에 데이터가 없으면 서버에서 가져오기
3. **자동 재시도**: 네트워크 에러 시 최대 3회 자동 재시도
4. **충돌 해결**: Last Write Wins 전략 (서버 타임스탬프 우선)
5. **오프라인 지속성**: Firestore 오프라인 캐시 활성화
6. **데이터 변경 시**: Firestore에 저장 및 로컬 캐시 자동 업데이트

## 사용자 경험

### 오프라인 지원

- 오프라인 상태에서도 기본 기능 사용 가능
- 온라인 상태가 되면 자동으로 동기화

### 성능 최적화

- **이미지 캐싱**: OCR 스캔 이미지를 캐시 디렉토리에 저장하여 재사용
  - 최대 캐시 크기: 50MB
  - 캐시 보관 기간: 7일
  - 자동 캐시 정리 기능
- **데이터 로컬 캐싱**: Firestore 오프라인 지속성 활성화
  - 캐시 우선 읽기 (오프라인에서도 빠른 응답)
  - 서버 동기화는 백그라운드에서 수행
- **지연 로딩**: 페이지네이션 지원
  - 대량 데이터 처리 시 성능 최적화
  - 초기 로딩 시간 단축
- **자동 재시도**: 네트워크 에러 시 자동 재시도
  - 최대 3회 재시도
  - 지수 백오프 전략

### 접근성

- Material Design 가이드라인 준수
- 명확한 네비게이션
- 직관적인 UI/UX

## 향후 계획

- 다국어 지원 (현재 일본어)
- 다크 모드 지원
- 소셜 로그인
- 가족/그룹 공유 기능
- 쇼핑 리스트 기능 강화

